
function getScrollHeight(e){return e[0].scrollHeight!==undefined?e[0].scrollHeight:e.find("html")[0].scrollHeight!==undefined&&e.find("html")[0].scrollHeight!==0?e.find("html")[0].scrollHeight:e.find("body")[0].scrollHeight}function syncPreview(){var e=window.ace.edit("editor"),t=$("#preview"),n=e.getSession().getLength(),r=getScrollHeight(t),i=e.getFirstVisibleRow()/n;t.scrollTop(i*r)}$(function(){function y(e,t){(function(n,r){var i=n.createElement(r),s=n.getElementsByTagName(r)[0];i.async=1,i.src=e,s.parentNode.insertBefore(i,s),i.onload=function(){t&&t()}})(document,"script")}function b(){var e;try{localStorage.getItem&&(e=localStorage)}catch(t){}return e}function w(){var e;try{e=JSON.parse(localStorage.profile),e=$.extend(!0,s,e)}catch(t){e=s}s=e}function E(e){localStorage.clear(),localStorage.profile=JSON.stringify($.extend(!0,s,e))}function S(e){return T(e,"pfx")}function x(e,t){for(var n in e)if(a[e[n]]!==undefined)return t==="pfx"?e[n]:!0;return!1}function T(e,t){var n=e.charAt(0).toUpperCase()+e.substr(1),r=(e+" "+f.join(n+" ")+n).split(" ");return x(r,t)}function N(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",transition:"transitionend"};return e[S("transition")]}function C(e){return"dillinger_"+(new Date).toISOString().replace(/[\.:-]/g,"_")+"."+e}function k(){return $('#filename > span[contenteditable="true"]').text()}function L(e){$('#filename > span[contenteditable="true"]').text(e||s.current_filename||"Untitled Document")}function A(e){if(e.nodeType===3)return e.data;var t="";if(e=e.firstChild)do t+=A(e);while(e=e.nextSibling);return t}function O(e){var t=e.replace(/W+/g," ").match(/\S+/g);return t&&t.length||0}function M(){b()?($.support.transitionEnd=N(),w(),_(),D(),marked.setOptions({gfm:!0,tables:!0,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,langPrefix:"lang-",highlight:function(e){return hljs.highlightAuto(e).value}}),t=marked,st(),ot(),ut(),at(),nt(),rt(),B(),et(),U()):K()}function _(){e=ace.edit("editor")}function D(){I(s.theme,function(){l.find('li > a[data-value="'+s.theme+'"]').addClass("selected"),e.getSession().setUseWrapMode(!0),e.setShowPrintMargin(!1),e.getSession().setMode("ace/mode/markdown"),e.getSession().setValue(s.currentMd||e.getSession().getValue()),R()}),c.css("backgroundImage",s.showPaper?'url("'+i+'")':'url("")'),h.html(s.autosave.enabled?'<i class="icon-ok"></i>&nbsp;Autosave is Enabled':'<i class="icon-remove"></i>&nbsp;Autosave is Disabled'),p.html(s.wordcount?'<i class="icon-ok"></i>&nbsp;Word Count is Enabled':'<i class="icon-remove"></i>&nbsp;Word Count is Disabled'),r=d.attr("data-github-username"),r&&ft.showMessage("What's Up "+r,1e3),L(),$(".dropdown-toggle").dropdown()}function P(){e.getSession().setValue(""),R()}function H(t){E({currentMd:e.getSession().getValue()}),t&&ft.showMessage(ft.messages.docSavedLocal)}function B(){s.autosave.enabled?n=setInterval(function(){H(),pt.saveFile(!1)},s.autosave.interval):clearInterval(n)}function j(){localStorage.clear(),s.autosave.enabled=!1,delete localStorage.profile,window.location.reload()}function F(e){var t=$(e.target);if(t.attr("data-value")===s.theme)return;l.find("li > a.selected").removeClass("selected"),t.addClass("selected");var n=t.attr("data-value");$(e.target).blur(),I(n,function(){ft.showMessage(ft.messages.profileUpdated)})}function I(t,n){var r=t.split("/").pop();y("/js/theme-"+r+".js",function(){e.setTheme(t),n&&n(),q(r),E({theme:t})})}function q(e){document.body.style.backgroundColor=g[e]}function R(){var n=e.getSession().getValue(),r=t(n);c.html("").html(r),U()}function U(e){var t="Words: ";e!==undefined&&(t+=e+" of "),s.wordcount&&v.text(t+O(A(c[0])))}function z(e){var t;typeof e=="string"?t=e:t=k(),E({current_filename:t})}function W(){function n(e,t,n){e=t=null;var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/md/"+r.data}function r(){alert("Roh-roh. Something went wrong. :(")}var t=e.getSession().getValue(),i={type:"POST",data:"unmd="+encodeURIComponent(t),dataType:"json",url:"/factory/fetch_markdown",error:r,success:n};$.ajax(i)}function X(){function n(e,t,n){var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/html/"+r.data}function r(){alert("Roh-roh. Something went wrong. :(")}var t=e.getSession().getValue(),i={type:"POST",data:"unmd="+encodeURIComponent(t),dataType:"json",url:"/factory/fetch_html",error:r,success:n};$.ajax(i)}function V(){function n(e,t,n){var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/pdf/"+r.data}function r(){alert("Roh-roh. Something went wrong. :(")}var t=e.getSession().getValue(),i={type:"POST",data:"unmd="+encodeURIComponent(t),dataType:"json",url:"/factory/fetch_pdf",error:r,success:n};$.ajax(i)}function J(){function n(e,t,n){var r=JSON.parse(n.responseText),i=$("#modalBodyText");$(i).val(r.data),$("#myModal").on("shown.bs.modal",function(e){$(i).focus().select()}).modal()}function r(){alert("Roh-roh. Something went wrong. :(")}var t=e.getSession().getValue(),i={type:"POST",data:"unmd="+encodeURIComponent(t),dataType:"json",url:"/factory/fetch_html_direct",error:r,success:n};$.ajax(i)}function K(){alert("Sad Panda - No localStorage for you!")}function Q(){$(".modal-header h3").text("What's the deal with Dillinger?");var e="<p>Dillinger is an online cloud-enabled, HTML5, buzzword-filled Markdown editor.</p><p>Dillinger was designed and developed by <a href='http://twitter.com/joemccann'>@joemccann</a> because he needed a decent Markdown editor.</p><p>Dillinger is a 100% open source project so <a href='https://github.com/joemccann/dillinger'>fork the code</a> and contribute!</p><p>Follow Dillinger on Twitter at <a href='http://twitter.com/dillingerapp'>@dillingerapp</a></p><p>Follow Joe McCann on Twitter at <a href='http://twitter.com/joemccann'>@joemccann</a></p>";$(".modal-body").html(e),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function G(){$(".modal-header h3").text("Preferences");var e='<div><ul><li><a href="#" id="paper">Toggle Paper</a></li><li><a href="#" id="reset">Reset Profile</a></li></ul></div>';$(".modal-body").html(e),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function Y(){c.css("backgroundImage",s.showPaper?'url("")':'url("'+i+'")'),E({showPaper:!s.showPaper}),ft.showMessage(ft.messages.profileUpdated)}function Z(){h.html(s.autosave.enabled?'<i class="icon-remove"></i>&nbsp;Autosave is Disabled':'<i class="icon-ok"></i>&nbsp;Autosave is Enabled'),E({autosave:{enabled:!s.autosave.enabled}}),B()}function et(){s.wordcount?(v.removeClass("hidden"),m.addClass("show-word-count-filename-adjust")):(v.addClass("hidden"),m.removeClass("show-word-count-filename-adjust"))}function tt(){p.html(s.wordcount?'<i class="icon-remove"></i>&nbsp;Word Count is Disabled':'<i class="icon-ok"></i>&nbsp;Word Count is Enabled'),E({wordcount:!s.wordcount}),et()}function nt(){$('#filename > span[contenteditable="true"]').bind("keyup",z)}function rt(){c.bind("mouseup",it)}function it(){if(s.wordcount){var e=window.getSelection().toString();e!==""?U(O(e)):U()}}function st(){$("#editor").bind("keyup",R)}function ot(){l.find("li > a").bind("click",function(e){return F(e),!1}),$("#clear").on("click",function(){return P(),!1}),$("#save_github").on("click",function(){return lt.save(),H(),!1}),$("#save_dropbox").on("click",function(){return s.current_filename=s.current_filename||"/Dillinger/"+C("md"),ht.putMarkdownFile(),H(),!1}),$("#save_googledrive").on("click",function(){ct.save(),H()}),$(".modal-body").delegate("#paper","click",function(){return Y(),!1}),$("#autosave").on("click",function(){return Z(),!1}),$("#wordcount").on("click",function(){return tt(),!1}),$("#reset").on("click",function(){return j(),!1}),d.on("click",function(){return lt.fetchOrgs(),!1}),$("#import_dropbox").on("click",function(){return ht.searchDropbox(),!1}),$("#import_googledrive").on("click",function(){return ct.search(),!1}),$("#export_md").on("click",function(){return W(),$(".dropdown").removeClass("open"),!1}),$("#export_html").on("click",function(){return X(),$(".dropdown").removeClass("open"),!1}),$("#export_pdf").on("click",function(){return V(),$(".dropdown").removeClass("open"),!1}),$("#show_html").on("click",function(){return J(),$(".dropdown").removeClass("open"),!1}),$("#preferences").on("click",function(){return G(),!1}),$("#about").on("click",function(){return Q(),!1}),$("#cheat").on("click",function(){return window.open("https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet","_blank"),!1}),$("#new_local_file").on("click",function(){return $(".dropdown").removeClass("open"),pt.newFile(),!1}),$("#import_local_file").on("click",function(){return $(".dropdown").removeClass("open"),pt.search(),!1}),$("#save_local_file").on("click",function(){return $(".dropdown").removeClass("open"),pt.saveFile(),!1})}function ut(){key("command+s, ctrl+s",function(e){H(!0),e.preventDefault()}),key("enter",function(e){e.target.parentNode&&e.target.parentNode.id==="filename"&&e.preventDefault()});var t={name:"save",bindKey:{mac:"Command-S",win:"Ctrl-S"},exec:function(){H(),pt.saveFile()}},n={name:"filenamer",bindKey:{mac:"Command-Shift-M",win:"Ctrl-Shift-M"},exec:function(){var e=JSON.parse(localStorage.profile);alert(e.current_filename.replace(/\s/g,"-").toLowerCase())}};e.commands.addCommand(t),e.commands.addCommand(n)}function at(){$(document).on("click",".org",function(){var e=$(this).parent("li").attr("data-org-name");return e!==lt.currentOwner?lt.currentPage=1:lt.currentPage=lt.currentPage||1,lt.currentOwner=e,lt.fetchRepos(lt.currentOwner),!1}).on("click",".repos.pager .next",function(){return lt.fetchRepos(lt.currentOwner,"next"),!1}).on("click",".repos.pager .previous",function(){return lt.currentPage<=1?!1:(lt.fetchRepos(lt.currentOwner,"prev"),!1)}).on("click",".repo",function(){var e=lt.currentOwner,t=$(this).parent("li").attr("data-repo-name");return lt.isRepoPrivate=$(this).parent("li").attr("data-repo-private")==="true"?!0:!1,lt.fetchBranches(e,t),!1}).on("click",".branch",function(){var e=lt.currentOwner,t=$(this).parent("li").attr("data-repo-name"),n=$(this).parent("li").attr("data-commit-sha"),r=$(this).text();return lt.currentBranch=r,lt.fetchTreeFiles(e,t,r,n),!1}).on("click",".tree_file",function(){var e=$(this).parent("li").attr("data-tree-file"),t=$(this).parent("li").attr("data-name"),n=$(this).parent("li").attr("data-tree-file-sha"),r=$(this).parent("li").attr("data-owner"),i=$(this).parent("li").attr("data-branch"),s=$(this).parent("li").attr("data-repo");return lt.fetchMarkdownFile(e,{name:t,sha:n,branch:i,owner:r,repo:s}),!1}).on("click",".github_org",function(){delete lt.currentPage,lt.fetchOrgs()}).on("click",".github_repo",function(){lt.fetchRepos(lt.currentOwner)}).on("click",".dropbox_file",function(){var e=$(this).parent("li").attr("data-file-path");return s.current_filename=e.split("/").pop().replace(".md",""),ht.setFilePath(e),ht.fetchMarkdownFile(e),!1}).on("click",".googledrive_file",function(){var e=$(this).parent("li").attr("data-file-id");return s.current_filename=$(this).html(),ct.fileId=e,ct.get(),!1}).on("click",".local_file",function(){var e=$(this).parent("li").attr("data-file-name");return s.current_filename=$(this).html(),pt.loadFile(e),!1}).on("click",".delete_local_file",function(){var e=$(this).parent("li"),t=e.attr("data-file-name");return pt.deleteFile(t),e.remove(),!1}),"draggable"in document.createElement("span")&&$("#editor").on("dragover",function(e){e.preventDefault(),e.stopPropagation()}).on("drop",function(t){t.preventDefault(),t.stopPropagation();var n=t.originalEvent,r=n.target.files||n.dataTransfer.files,i=new FileReader,s=0,o,u;do o=r[s++];while(o&&o.type.substr(0,4)!=="text"&&o.name.substr(o.name.length-3)!==".md");if(!o)return;i.onload=function(t){e.getSession().setValue(t.target.result),R()},i.readAsText(o)})}var e,t,n,r,i="/img/notebook_paper_200x200.gif",s={theme:"ace/theme/idle_fingers",showPaper:!1,currentMd:"",autosave:{enabled:!0,interval:3e3},wordcount:!0,current_filename:"Untitled Document",github:{current_uri:"",opts:{}},dropbox:{filepath:"/Dillinger/"},local_files:{"Untitiled Document":""}},o="dillinger",u=document.createElement(o),a=u.style,f="Webkit Moz O ms Khtml".split(" "),l=$("#theme-list"),c=$("#preview"),h=$("#autosave"),p=$("#wordcount"),d=$("#import_github"),v=$("#wordcounter"),m=$("#filename"),g={chrome:"#bbbbbb",clouds:"#7AC9E3",clouds_midnight:"#5F9EA0",cobalt:"#4d586b",crimson_editor:"#ffffff",dawn:"#DADCAD",eclipse:"#6C7B8A",idle_fingers:"#DEB887",kr_theme:"#434343",merbivore:"#3E353E",merbivore_soft:"#565156",mono_industrial:"#C0C0C0",monokai:"#F5DEB3",pastel_on_dark:"#676565","solarized-dark":"#0E4B5A",solarized_light:"#dfcb96",textmate:"#fff",tomorrow:"#0e9211",tomorrow_night:"#333536",tomorrow_night_blue:"#3a4150",tomorrow_night_bright:"#3A3A3A",tomorrow_night_eighties:"#474646",twilight:"#534746",vibrant_ink:"#363636"},ft=function(){var e=$("#notify");return{messages:{profileUpdated:"Profile updated",profileCleared:"Profile cleared",docSavedLocal:"Document saved locally",docDeletedLocal:"Document deleted from local storage",docSavedServer:"Document saved on our server",docSavedDropbox:"Document saved on Dropbox",docSavedGithub:"Document saved on Github",dropboxImportNeeded:"Please import a file from Dropbox first."},showMessage:function(t,n){e.text("").stop().text(t).slideDown(250,function(){e.delay(n||1e3).slideUp(250)})}}}(),lt=function(){function t(e,t){var n=e.url.toLowerCase(),r=t.url.toLowerCase();return n===r?0:isNaN(e)||isNaN(t)?n>r?1:-1:e-t}function n(e){return/(\.md)|(\.markdown)/i.test(e)}function i(e,t){var r=[],i="https://raw.github.com",s="/",o=/https:\/\/api.github.com\/(.*?)\/(.*?)\/(.*?)\/(.*)/i;return t.forEach(function(e){if(n(e.path)){var t,u,a,f;u=e.url.match(o),f=u[2],a=u[3],lt.isRepoPrivate?t=e.url:t=i+s+f+s+a+s+lt.currentBranch+s+e.path;var l={link:t,path:e.path,sha:e.sha,repo:a,owner:f};r.push(l)}}),r}function o(e){var n='<ul><li data-org-name="'+r+'" data-user="true"><a class="org" href="#">'+r+"</a></li>";return e.sort(t),e.forEach(function(e){n+='<li data-org-name="'+e.name+'"><a class="org" href="#">'+e.name+"</a></li>"}),n+="</ul>",$(".modal-header h3").text("Your Github Orgs"),$(".modal-body").html(n),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function u(e){var n='<li class="github_org"><a href="#">Back to organizations...</a></li>',r='<ul class="repos pager"><li class="previous'+(!lt.currentPage||lt.currentPage===1?" disabled":"")+'"><a href="#">&larr; Prev</a></li><li class="next"><a href="#">Next &rarr;</a></li></ul>';return e.sort(t),e.forEach(function(e){n+='<li data-repo-name="'+e.name+'" data-repo-private="'+e.private+'"><a class="repo" href="#">'+e.name+"</a></li>"}),$(".modal-header h3").text(lt.currentOwner),$(".modal-body").find("ul").find("li").remove().end().append(n).end().find(".pager").remove().end().append(r),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function a(e,t){var n='<li class="github_repo"><a href="#">Back to repositories...</a></li>';t.forEach(function(t){var r=t.name,i=t.commit.sha;n+='<li data-repo-name="'+e+'" data-commit-sha="'+i+'"><a class="branch" href="#">'+r+"</a></li>"}),$(".modal-header h3").text(lt.currentOwner+" > "+e),$(".modal-body").find("ul").find("li").remove().end().append(n).end().find(".pager").remove()}function f(e,t,n,r){var s=i(e,r),o='<li class="refresh_branches" data-repo-name="'+e+'"><a class="repo" href="#">Back to branches in '+e+"...</a></li>";s.length===0?o+='<li class="no_files">No Markdown files in this branch</li>':s.forEach(function(e){o+=lt.isRepoPrivate?'<li data-tree-file-sha="'+e.sha+'" data-tree-file="'+e.link+'" data-repo="'+e.repo+'" data-owner="'+e.owner+'" data-name="'+e.path+'" data-branch="'+t+'" class="private_repo"><a class="tree_file" href="#">'+e.path+"</a></li>":'<li data-tree-file-sha="'+e.sha+'" data-tree-file="'+e.link+'" data-repo="'+e.repo+'" data-owner="'+e.owner+'" data-name="'+e.path+'" data-branch="'+t+'"><a class="tree_file" href="#">'+e.path+"</a></li>"}),$(".modal-header h3").text(lt.currentOwner+" > "+e+" > "+lt.currentBranch),$(".modal-body").find("ul").find("li").remove().end().append(o).end().find(".pager").remove()}return{isRepoPrivate:!1,fetchOrgs:function(){function e(){ft.showMessage("Fetching Orgs...")}function t(e,t,n){e=t=null,n=JSON.parse(n.responseText),o(n)}function n(e,t){alert(e.responseText||"Roh-roh. Something went wrong. :(")}var r={type:"POST",dataType:"text",url:"/import/github/orgs",beforeSend:e,error:n,success:t};$.ajax(r)},fetchRepos:function(e,t){function n(){ft.showMessage("Fetching Repos...")}function r(e,n,r){e=n=null,r=JSON.parse(r.responseText),r.length?(t==="next"&&lt.currentPage++,t==="prev"&&lt.currentPage--,lt.currentPage<=1?$(".repos.pager .previous").addClass("disabled"):$(".repos.pager .previous").removeClass("disabled"),lt.currentPage<1&&(lt.currentPage=1),u(r)):ft.showMessage("No repos available!")}function i(e,t){alert(e.responseText||"Roh-roh. Something went wrong. :(")}var s={type:"POST",dataType:"text",url:"/import/github/repos",beforeSend:n,error:i,success:r},o;s.data="owner="+e,t==="next"?o=lt.currentPage+1:t==="prev"?o=lt.currentPage-1:o=lt.currentPage,o>1&&(s.data+="&page="+o),$.ajax(s)},fetchBranches:function(e,t){function n(){ft.showMessage("Fetching Branches for Repo "+t)}function r(e,n,r){e=n=null,r=JSON.parse(r.responseText),r.length?a(t,r):(ft.showMessage("No branches available!"),$("#modal-generic").modal("hide"))}function i(){alert("Roh-roh. Something went wrong. :(")}var s={type:"POST",dataType:"json",data:"owner="+e+"&repo="+t,url:"/import/github/branches",beforeSend:n,error:i,success:r};$.ajax(s)},fetchTreeFiles:function(e,t,n,r){function i(){ft.showMessage("Fetching Tree for Repo "+t)}function s(e,i,s){e=i=null,s=JSON.parse(s.responseText),s.tree.length?f(t,n,r,s.tree):(ft.showMessage("No tree files available!"),$("#modal-generic").modal("hide"))}function o(){alert("Roh-roh. Something went wrong. :(")}var u={type:"POST",dataType:"json",data:"owner="+e+"&repo="+t+"&branch="+n+"&sha="+r,url:"/import/github/tree_files",beforeSend:i,error:o,success:s};$.ajax(u)},fetchMarkdownFile:function(t,n){function r(r,i,s){r=i=null,s=JSON.parse(s.responseText);if(s.error)ft.showMessage("No markdown for you!"),$("#modal-generic").modal("hide");else{$("#modal-generic").modal("hide"),e.getSession().setValue(s.data);var o=n.name.split("/").pop();z(o),L(o),lt.setInfo(t,n),R()}}function i(){alert("Roh-roh. Something went wrong. :(")}function s(){$(".dropdown").removeClass("open")}var o={type:"POST",dataType:"json",data:"url="+t+"&name="+name,url:"/import/github/file",error:i,success:r,complete:s};$.ajax(o)},clear:function(){delete s.github.current_uri,delete s.github.opts},setInfo:function(e,t){s.github.current_uri=e,s.github.opts=t},getUri:function(){return s.github.current_uri},save:function(){function t(e){alert("Roh-roh. Something went wrong. :(",e)}function n(e,t,n){var r=JSON.parse(n.responseText);n.status<400?(s.github.opts.sha=r.content.sha,ft.showMessage(ft.messages.docSavedGithub+" as "+r.content.path)):ft.showMessage("An error occurred!")}function r(){$("#modal-generic").modal("hide")}var i={uri:lt.getUri()||"",data:btoa(e.getSession().getValue()),name:s.github.opts.name,sha:s.github.opts.sha,branch:s.github.opts.branch,repo:s.github.opts.repo,owner:s.github.opts.owner},o={type:"POST",data:i,url:"/save/github",error:t,success:n};$.ajax(o)}}}(),ct=function(){function t(e,t,n){ft.showMessage(n.responseText)}function n(e,n,r){var i=JSON.parse(r.responseText),s="<ul>";if(!Array.isArray(i.items))return t(null,null,{responseText:"No Markdown files found!"});i.items.forEach(function(e){s+='<li data-file-id="'+e.id+'"><a class="googledrive_file" href="#">'+e.title+"</a></li>"}),s+="</ul>",$(".modal-header h3").text("Your Google Drive Files"),$(".modal-body").html(s),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function r(t,n,r){var i=JSON.parse(r.responseText);$("#modal-generic").modal("hide"),e.getSession().setValue(i.content),R(),lt.clear()}return{fileId:null,search:function(){$.ajax({dataType:"json",url:"/import/googledrive",beforeSend:function(){ft.showMessage("Searching for .md files")},error:t,success:n})},get:function(){$.ajax({dataType:"json",url:"/fetch/googledrive?fileId="+this.fileId,error:t,success:r})},save:function(){var n=encodeURIComponent(e.getSession().getValue()),r=/(.md|.markdown)$/.test(s.current_filename),i="title="+encodeURIComponent(s.current_filename)+(r?"":".md")+"&content="+n;$.ajax({dataType:"json",type:"post",data:i,url:"/save/googledrive?fileId="+(ct.fileId||""),error:t,success:function(e,t,n){var r=JSON.parse(n.responseText);r.id?(ct.fileId=r.id,ft.showMessage("Document saved on Google Drive")):ft.showMessage("An error occurred!")}})}}}(),ht=function(){function t(e,t){var n=e.path.toLowerCase(),r=t.path.toLowerCase();return n===r?0:isNaN(e)||isNaN(t)?n>r?1:-1:e-t}function n(e){var n="<ul>";return e.sort(t),e.forEach(function(e){n+='<li data-file-path="'+e.path+'"><a class="dropbox_file" href="#">'+e.path+"</a></li>"}),n+="</ul>",$(".modal-header h3").text("Your Dropbox Files"),$(".modal-body").html(n),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function r(e){return encodeURIComponent(e.split("/").pop())}function i(e){var t=e.split("/").pop();return e.replace(t,"")}return{fetchAccountInfo:function(){function e(){ft.showMessage("Fetching User Info from Dropbox")}function t(e,t,n){var r=JSON.parse(n.responseText);ft.showMessage("Sup "+r.display_name)}function n(){alert("Roh-roh. Something went wrong. :(")}var r={type:"GET",dataType:"json",url:"/account/dropbox",beforeSend:e,error:n,success:t};$.ajax(r)},fetchMetadata:function(){function e(){ft.showMessage("Fetching Metadata")}function t(e,t,n){var r=JSON.parse(n.responseText);window.console&&window.console.log&&console.dir(r)}function n(){alert("Roh-roh. Something went wrong. :(")}var r={type:"GET",dataType:"json",url:"/dropbox/metadata",beforeSend:e,error:n,success:t};$.ajax(r)},searchDropbox:function(){function e(){ft.showMessage("Searching for .md Files")}function t(e,t,r){e=t=null;var i=JSON.parse(r.responseText);if(i.hasOwnProperty("statusCode")&&i.statusCode===401){var s=JSON.parse(i.data);return ft.showMessage("Error! "+s.error,1e3),setTimeout(function(){ft.showMessage("Reloading!"),window.location.reload()},1250)}i.length?n(i):ft.showMessage("No .md files found!")}function r(e,t){alert(e.responseText||"Roh-roh. Something went wrong. :(")}var i={type:"GET",dataType:"json",url:"/import/dropbox",beforeSend:e,error:r,success:t};$.ajax(i)},fetchMarkdownFile:function(t){function n(t,n,r){r=JSON.parse(r.responseText);if(r.statusCode===404){var i=JSON.parse(r.data);ft.showMessage(i.error)}else $("#modal-generic").modal("hide"),z(s.current_filename),L(),e.getSession().setValue(r.data),R(),lt.clear()}function o(){alert("Roh-roh. Something went wrong. :(")}var u=r(t),a=i(t);t=a+u;var f={type:"POST",dataType:"json",data:"mdFile="+t,url:"/fetch/dropbox",error:o,success:n};$.ajax(f)},setFilePath:function(e){e=i(e),E({dropbox:{filepath:e}})},putMarkdownFile:function(){function t(e,t,n){e=t=null,n=JSON.parse(n.responseText);if(n.statusCode>=204){var r=JSON.parse(n.data);ft.showMessage(r.error,5e3)}else $("#modal-generic").modal("hide"),ft.showMessage(ft.messages.docSavedDropbox)}function n(){alert("Roh-roh. Something went wrong. :(")}var r=encodeURIComponent(e.getSession().getValue()),i="pathToMdFile="+s.dropbox.filepath+encodeURIComponent(s.current_filename)+".md"+"&fileContents="+r,o={type:"POST",dataType:"json",data:i,url:"/save/dropbox",error:n,success:t};$.ajax(o)}}}(),pt=function(){function t(e,t){var n=e.toLowerCase(),r=t.toLowerCase();return n===r?0:isNaN(e)||isNaN(t)?n>r?1:-1:e-t}function n(e){var n="<ul>";return e.sort(t),e.forEach(function(e){n+='<li data-file-name="'+e+'"><a class="delete_local_file"><i class="icon-remove"></i></a><a class="local_file" href="#">'+e+"</a></li>"}),n+="</ul>",$(".modal-header h3").text("Your Local Files"),$(".modal-body").html(n),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}return{newFile:function(){z(""),L(),e.getSession().setValue("")},search:function(){var e=Object.keys(s.local_files);e.length<1?ft.showMessage("No files saved locally"):n(e)},loadFile:function(t){$("#modal-generic").modal("hide"),z(t),L(),e.getSession().setValue(s.local_files[t]),R(),lt.clear()},saveFile:function(t){var n=k(),r=e.getSession().getValue(),i={local_files:{}};i.local_files[n]=r,E(i),t!==!1&&ft.showMessage(ft.messages.docSavedLocal)},deleteFile:function(e){var t=s.local_files;delete s.local_files[e],E(),ft.showMessage(ft.messages.docDeletedLocal)}}}();window.foo=pt.saveFile,M()}),window.onload=function(){var e=$("#loading");$.support.transition?e.bind($.support.transitionEnd,function(){$("#main").removeClass("bye"),e.remove()}).addClass("fade_slow"):($("#main").removeClass("bye"),e.remove()),window.ace.edit("editor").session.on("changeScrollTop",syncPreview),window.ace.edit("editor").session.selection.on("changeCursor",syncPreview)}